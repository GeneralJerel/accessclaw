# Mock Database — Firebase-Style NoSQL Store

> Last updated: 2026-02-20

---

## Overview

The mock database simulates a Firebase/Firestore-style NoSQL store entirely in-memory. It provides collections with document CRUD, querying, and real-time subscriptions — enough to build and demo the full frontend without a backend.

---

## Collections

| Collection | Document Key | Description |
|------------|-------------|-------------|
| `dailyBriefs` | `brief_{date}` | Morning briefs generated by OpenClaw |
| `inbox` | `email_{id}` | All emails — inbound and outbound, with AI metadata |
| `invoices` | `inv_{id}` | Invoices and payment records |
| `tasks` | `task_{id}` | Tasks / to-dos created by OpenClaw or user |
| `calendar` | `evt_{id}` | Calendar events (calls, deep work, routine) |
| `clients` | `cli_{id}` | Client profiles |

---

## File Structure

```
mock-data/
├── db.js           # Core database engine (collection factory, CRUD, subscribe)
├── seed.js         # All seed data for the 6 collections + scenarioOnlyEmails
├── index.js        # Boots the db, seeds collections, exports helpers
├── eventBus.js     # Lightweight pub/sub for cross-page communication
└── scenario/       # Legacy files (backward-compatible re-exports)
    ├── index.js    # Bridge: re-exports from seed.js for old imports
    ├── calendar.js # calendarSlots, calendarInvite (scenario-specific)
    ├── tasks.js    # notionPage (scenario-specific)
    └── openclawTasks.js  # OpenClaw recurring task definitions + activity log
```

---

## API Reference

### Accessing a Collection

```js
import db from '@/mock-data';

const inbox = db.collection('inbox');
```

### Collection Methods

| Method | Signature | Description |
|--------|-----------|-------------|
| `getAll()` | `() → Doc[]` | All documents in the collection |
| `get(id)` | `(id: string) → Doc \| null` | Single document by ID |
| `add(doc)` | `(doc: object) → Doc` | Insert a new document (auto-generates `id` if missing) |
| `update(id, partial)` | `(id: string, partial: object) → Doc \| null` | Merge partial update into existing doc |
| `remove(id)` | `(id: string) → boolean` | Delete a document |
| `query(predicate)` | `(fn: Doc → boolean) → Doc[]` | Filter documents |
| `count()` | `() → number` | Document count |
| `subscribe(listener)` | `(fn: Doc[] → void) → unsubscribe` | Real-time listener; returns unsubscribe function |
| `reset(docs)` | `(docs?: Doc[]) → void` | Replace all documents (for testing/reset) |

### Convenience Helpers

```js
import db, {
  sendEmail,
  getThread,
  getInboxByUrgency,
  getUnreadEmails,
  getTasksByStatus,
  getTasksDueToday,
  getUpcomingEvents,
  getOutstandingInvoices,
  getOverdueInvoices,
  getTodaysBrief,
  getClientById,
  freelancer,
} from '@/mock-data';
```

| Helper | Description |
|--------|-------------|
| `sendEmail({ to, subject, body, ... })` | Appends a new email to inbox with sensible defaults |
| `getThread(threadId)` | All emails in a thread, sorted chronologically |
| `getInboxByUrgency(level)` | Filter inbox by urgency (`high`, `medium`, `low`) |
| `getUnreadEmails()` | All unread emails |
| `getTasksByStatus(status)` | Filter tasks (`todo`, `in-progress`, `done`) |
| `getTasksDueToday()` | Tasks due today |
| `getUpcomingEvents(hours)` | Calendar events in next N hours (default 24) |
| `getOutstandingInvoices()` | Unpaid invoices |
| `getOverdueInvoices()` | Invoices past due date |
| `getTodaysBrief()` | Today's daily brief or null |
| `getClientById(id)` | Single client by ID |
| `freelancer` | Freelancer profile (singleton) |

---

## Subscribing to Changes

```js
const unsubscribe = db.collection('inbox').subscribe((allEmails) => {
  console.log('Inbox updated:', allEmails.length, 'emails');
});

// Later:
unsubscribe();
```

---

## Adding Data at Runtime

When the user clicks "Approve & Send" on an email draft:

```js
import { sendEmail } from '@/mock-data';

sendEmail({
  to: { name: 'David Park', email: 'david.park@rivierahg.com' },
  subject: 'Re: Rebrand Project',
  body: 'Hi David, ...',
  threadId: 'thread_david_rebrand',
  generatedBy: 'openclaw',
  approvedBy: 'maya',
});
```

The email is immediately added to `db.collection('inbox')` and any subscribers are notified.

---

## Event Bus — Cross-Tab Communication

The event bus (`mock-data/eventBus.js`) uses the browser `BroadcastChannel` API to deliver events across tabs. The Scenario page (tab 1) emits events, and the Dashboard (tab 2) receives them. The same `on`/`emit` API also works within a single tab.

**How it works:**
- `emit(event, payload)` fires local listeners AND posts to `BroadcastChannel('openclaw_scenario')`
- Messages arriving from other tabs fire local listeners in the receiving tab
- Falls back to local-only if `BroadcastChannel` is unavailable

```js
import eventBus from '../../mock-data/eventBus';

// Emit from Scenario (crosses to Dashboard tab)
eventBus.emit('inbox:add', { email: { ...emailDoc } });
eventBus.emit('chat:message', { text: 'New email from David Park...', role: 'system' });
eventBus.emit('ui:switchView', { workspace: 'inbox' });

// Subscribe from Dashboard
const unsub = eventBus.on('inbox:add', ({ email }) => {
  db.collection('inbox').add({ ...email });
});
unsub(); // cleanup
```

| Event | Payload | Dashboard Reaction |
|-------|---------|-------------------|
| `inbox:add` | `{ email }` | Adds email to local DB (triggers subscribe) |
| `scenario:reset` | `{}` | Removes scenario emails, resets chat and view |
| `chat:message` | `{ text, role }` | Appends message to AI chat panel |
| `chat:typing` | `{ isTyping }` | Shows/hides typing indicator |
| `ui:switchView` | `{ workspace }` | Switches active workspace view |
| `ui:selectEmail` | `{ emailId }` | Selects and highlights the email |

**Demo mode:** The Scenario page opens `/dashboard?demo=true` in a new tab, which bypasses the password gate.

---

## Scenario-Only Emails

The David Park thread (email_01, email_02, email_03) is exported separately as `scenarioOnlyEmails` from `seed.js`. These emails are **not** seeded into the inbox on startup — they are dynamically added by the Scenario page when each step fires, which triggers Dashboard reactivity via `db.subscribe`.

```js
import { scenarioOnlyEmails } from '../../mock-data/seed';

// Scenario adds them one at a time
db.collection('inbox').add({ ...scenarioOnlyEmails[0] });
```

---

## Migration from Legacy Imports

Old imports from `mock-data/scenario/*.js` still work via a backward-compatible bridge in `mock-data/scenario/index.js`. New code should import from `mock-data/index.js`.

**Before:**
```js
import { emails } from '../../mock-data/scenario/emails';
import { dailyBrief } from '../../mock-data/scenario/dailyBrief';
```

**After:**
```js
import db from '../../mock-data';

const emails = db.collection('inbox').getAll();
const brief = db.collection('dailyBriefs').getAll()[0];
```
